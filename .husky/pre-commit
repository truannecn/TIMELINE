echo "Running TypeScript type check..."

OUTPUT=$(npx tsc --noEmit 2>&1)
TSC_EXIT_CODE=$?

if [ $TSC_EXIT_CODE -ne 0 ]; then
  echo "$OUTPUT" | head -100
  echo ""
  echo "❌ TypeScript type check failed. Please fix the errors above before committing."
  exit 1
fi

echo "✓ TypeScript type check passed"
echo ""

# Run AI code review if DEDALUS_API_KEY is set and SKIP_REVIEW is not true
if [ "$SKIP_REVIEW" = "true" ]; then
  echo "⚠️  Skipping AI code review (SKIP_REVIEW=true)"
  echo "   Use with caution - bypassing security checks!"
elif [ -n "$process.env.DEDALUS_API_KEY" ]; then
  echo "Running AI code review..."
  npx tsx scripts/code-review.ts
  REVIEW_EXIT_CODE=$?

  if [ $REVIEW_EXIT_CODE -ne 0 ]; then
    echo ""
    echo "❌ Code review failed. Please fix critical issues above before committing."
    exit 1
  fi
else
  echo "⚠️  Skipping AI code review (DEDALUS_API_KEY not set)"
  echo "   Set DEDALUS_API_KEY in .env.local to enable automated reviews"
fi
